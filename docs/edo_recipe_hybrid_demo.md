# æ±Ÿæˆ¸æ–™ç†ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ãƒ‡ãƒ¢ä½¿ç”¨ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

æ±Ÿæˆ¸æ–™ç†ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ãƒ‡ãƒ¢ã¯ã€PostgreSQLã®**pg_bigmï¼ˆå…¨æ–‡æ¤œç´¢ï¼‰**ã¨**pg_vectorï¼ˆãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ï¼‰**ã‚’çµ„ã¿åˆã‚ã›ãŸé«˜åº¦ãªæ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã¨æ„å‘³çš„æ¤œç´¢ã‚’çµ±åˆã—ã€å®Ÿç”¨çš„ãªè¤‡åˆæ¤œç´¢æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

## ç‰¹å¾´

- ğŸ” **4ã¤ã®æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰**: æ®µéšçš„æ¤œç´¢ã€ä¸¦åˆ—æ¤œç´¢ã€å…¨æ–‡ã®ã¿ã€ãƒ™ã‚¯ãƒˆãƒ«ã®ã¿
- ğŸ“‹ **è¤‡åˆæ¡ä»¶æ¤œç´¢**: å¿…é ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ + é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ + æ„å‘³çš„æ¤œç´¢
- âš–ï¸ **ã‚¹ã‚³ã‚¢åˆæˆ**: é‡ã¿ä»˜ããƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
- âš¡ **æ€§èƒ½æ¸¬å®š**: å®Ÿè¡Œæ™‚é–“ã€CPUã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®è¡¨ç¤º
- ğŸ“š **äº‹å‰å®šç¾©ã‚·ãƒŠãƒªã‚ª**: å®Ÿç”¨çš„ãªæ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³

## å‰ææ¡ä»¶

### å¿…è¦ãªãƒ‡ãƒ¼ã‚¿

1. **æ±Ÿæˆ¸æ–™ç†åŸºæœ¬ãƒ‡ãƒ¼ã‚¿**: `edo_recipes`ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨
2. **ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰: `edo_recipe_vectors`ãƒ†ãƒ¼ãƒ–ãƒ«ã¨OpenAIåŸ‹ã‚è¾¼ã¿ãƒ‡ãƒ¼ã‚¿

### ç’°å¢ƒç¢ºèª

```bash
# åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
docker exec python_postgres_demo python -c "
import sys; sys.path.append('/app/src')
from common.database_config import DatabaseConfig
from common.edo_recipe_manager import EdoRecipeManager
db_config = DatabaseConfig.from_environment()
manager = EdoRecipeManager(db_config)
print(f'æ±Ÿæˆ¸æ–™ç†ãƒ†ãƒ¼ãƒ–ãƒ«: {\"âœ…\" if manager.tables_exist() else \"âŒ\"}')
manager.cur.execute('SELECT COUNT(*) FROM edo_recipes')
print(f'ãƒ¬ã‚·ãƒ”æ•°: {manager.cur.fetchone()[0]}ä»¶')
manager.close()
"
```

## ãƒ‡ãƒ¢ã®å®Ÿè¡Œ

### åŸºæœ¬å®Ÿè¡Œæ–¹æ³•

```bash
# Pythonã‚³ãƒ³ãƒ†ãƒŠå†…ã§ãƒ‡ãƒ¢ã‚’å®Ÿè¡Œ
docker exec -it python_postgres_demo /bin/bash
cd /app
python src/apps/edo_recipe_hybrid_demo.py
```

## åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

åˆå›å®Ÿè¡Œæ™‚ã¯ä»¥ä¸‹ã®æ‰‹é †ã§ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼š

1. **åŸºæœ¬ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–**: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ãƒ‡ãƒ¢ã®ã€ŒåŸºæœ¬ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–ã€æ©Ÿèƒ½ã§æ±Ÿæˆ¸æ–™ç†ãƒ¬ã‚·ãƒ”ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
2. **ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ**: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ãƒ‡ãƒ¢ã®ã€Œãƒ™ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–ã€æ©Ÿèƒ½ã‚’ä½¿ç”¨

## æ©Ÿèƒ½ç´¹ä»‹

### 1. ã‚«ã‚¹ã‚¿ãƒ æ¤œç´¢

è‡ªç”±ã«æ¤œç´¢æ¡ä»¶ã‚’è¨­å®šã§ãã‚‹æŸ”è»Ÿãªæ¤œç´¢æ©Ÿèƒ½ã§ã™ã€‚

#### è¨­å®šé …ç›®

**å¿…é ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®š**
- å«ã¾ãªã‘ã‚Œã°ãªã‚‰ãªã„è¨€è‘‰ã‚’æŒ‡å®š
- è¤‡æ•°ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ›
- é¡ä¼¼åº¦é–¾å€¤ã®èª¿æ•´å¯èƒ½ï¼ˆ0.1-1.0ï¼‰

```
ä¾‹: ã ã—, é­š
é–¾å€¤: 0.2 (ã‚ˆã‚Šå³å¯†ãªãƒãƒƒãƒãƒ³ã‚°)
```

**é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®š**
- å«ã‚“ã§ã¯ãªã‚‰ãªã„è¨€è‘‰ã‚’æŒ‡å®š
- è¤‡æ•°æ¡ä»¶ã§ã®çµã‚Šè¾¼ã¿ãŒå¯èƒ½

```
ä¾‹: è‚‰, ç ‚ç³–, æ²¹
é–¾å€¤: 0.1 (åºƒç¯„å›²ã®é™¤å¤–)
```

**æ„å‘³çš„æ¤œç´¢è¨­å®š**
- è‡ªç„¶è¨€èªã§ã®æ¤œç´¢æ„å›³ã‚’å…¥åŠ›
- OpenAIåŸ‹ã‚è¾¼ã¿ã«ã‚ˆã‚‹æ„å‘³çš„é¡ä¼¼åº¦æ¤œç´¢

```
ä¾‹: "ã†ã¾å‘³ã®åŠ¹ã„ãŸã‚ã£ã•ã‚Šã—ãŸæ–™ç†"
```

**ã‚¹ã‚³ã‚¢é‡ã¿èª¿æ•´**
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒã¨æ„å‘³çš„é¡ä¼¼åº¦ã®é‡ã¿æ¯”ç‡
- 0.0-1.0ã®ç¯„å›²ã§èª¿æ•´

```
ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é‡è¦–: 0.7 (ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰) + 0.3 (æ„å‘³çš„)
æ„å‘³çš„é‡è¦–:     0.3 (ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰) + 0.7 (æ„å‘³çš„)
```

#### æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰

1. **æ®µéšçš„æ¤œç´¢ï¼ˆCASCADEï¼‰**
   - é«˜é€Ÿå‡¦ç†é‡è¦–
   - pg_bigm â†’ pg_vector ã®é †æ¬¡å®Ÿè¡Œ
   - å¤§é‡ãƒ‡ãƒ¼ã‚¿ã«é©ã—ã¦ã„ã‚‹

2. **ä¸¦åˆ—æ¤œç´¢ï¼ˆPARALLELï¼‰**
   - é«˜ç²¾åº¦é‡è¦–
   - åŒæ™‚ã‚¹ã‚³ã‚¢è¨ˆç®—ã«ã‚ˆã‚‹åŒ…æ‹¬çš„æ¤œç´¢
   - ã‚ˆã‚Šå¤šãã®çµæœã‚’ç™ºè¦‹

3. **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ã¿ï¼ˆFULLTEXT_ONLYï¼‰**
   - pg_bigmå…¨æ–‡æ¤œç´¢ã®ã¿
   - é«˜é€Ÿå®Ÿè¡Œ
   - å¾“æ¥ã®æ¤œç´¢æ‰‹æ³•

4. **æ„å‘³æ¤œç´¢ã®ã¿ï¼ˆVECTOR_ONLYï¼‰**
   - pg_vectorãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã®ã¿
   - æ„å‘³çš„é–¢é€£æ€§é‡è¦–
   - ç™ºè¦‹æ€§ã®é«˜ã„æ¤œç´¢

### 2. ã‚·ãƒŠãƒªã‚ªæ¤œç´¢

å®Ÿç”¨çš„ãªæ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’äº‹å‰å®šç¾©ã—ãŸãƒ‡ãƒ¢ã§ã™ã€‚

#### åˆ©ç”¨å¯èƒ½ã‚·ãƒŠãƒªã‚ª

**ğŸ¥š åµæ–™ç†å°‚é–€æ¤œç´¢**
```
å¿…é ˆ: åµ
é™¤å¤–: è‚‰ AND é­š
æ„å‘³: "è‰²é®®ã‚„ã‹ã§ç¾ã—ã„åµæ–™ç†"
é‡ã¿: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰(40%) + æ„å‘³çš„(60%)
ãƒ¢ãƒ¼ãƒ‰: æ®µéšçš„æ¤œç´¢
```

**ğŸŒˆ è¯ã‚„ã‹åµæ–™ç†æ¤œç´¢**
```
å¿…é ˆ: åµ
æ„å‘³: "è¯ã‚„ã‹ã§å½©ã‚Šè±Šã‹ãªåµæ–™ç†"
é‡ã¿: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰(60%) + æ„å‘³çš„(40%)
ãƒ¢ãƒ¼ãƒ‰: ä¸¦åˆ—æ¤œç´¢
```

**ğŸ² ãŠå¸ã„ç‰©é¢¨æ¤œç´¢**
```
å¿…é ˆ: åµ
æ„å‘³: "ä¸Šå“ã§ã‚„ã•ã—ã„å‘³ã®æ–™ç†"
é‡ã¿: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰(40%) + æ„å‘³çš„(60%)
ãƒ¢ãƒ¼ãƒ‰: æ®µéšçš„æ¤œç´¢
```

**ğŸ¨ è‰²é®®ã‚„ã‹åµæ¤œç´¢**
```
å¿…é ˆ: åµ
æ„å‘³: "è‰²ã¨ã‚Šã©ã‚Šã§ç¾ã—ã„åµæ–™ç†"
é‡ã¿: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰(50%) + æ„å‘³çš„(50%)
ãƒ¢ãƒ¼ãƒ‰: ä¸¦åˆ—æ¤œç´¢
```

### 3. æ€§èƒ½æ¯”è¼ƒãƒ‡ãƒ¢

ç•°ãªã‚‹æ¤œç´¢æ‰‹æ³•ã®æ€§èƒ½ã‚’æ¯”è¼ƒæ¸¬å®šã§ãã¾ã™ã€‚

### 4. åŸºæœ¬ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–

æ±Ÿæˆ¸æ–™ç†ãƒ¬ã‚·ãƒ”ã®åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚

#### æ©Ÿèƒ½æ¦‚è¦
- `edo_recipes` ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆã¨åŸºæœ¬ãƒ¬ã‚·ãƒ”ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥
- `recipe_ingredients` ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆã¨ææ–™ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥  
- `recipe_instructions` ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆã¨æ‰‹é †ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦å®‰å…¨ã«å®Ÿè¡Œ

#### å®Ÿè¡Œä¾‹
```
ğŸ”§ åŸºæœ¬ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–

æ±Ÿæˆ¸æ–™ç†ãƒ¬ã‚·ãƒ”ã®åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
ã“ã®å‡¦ç†ã§ã¯ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆãƒ»ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã—ã¾ã™:
  â€¢ edo_recipes (ãƒ¬ã‚·ãƒ”åŸºæœ¬æƒ…å ±)
  â€¢ recipe_ingredients (ææ–™æƒ…å ±)
  â€¢ recipe_instructions (æ‰‹é †æƒ…å ±)

ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ç¢ºèªä¸­...
  âš ï¸  åŸºæœ¬ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚ä½œæˆã—ã¾ã™...
  âœ… åŸºæœ¬ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ
  ğŸ“‹ æ—¢å­˜ãƒ¬ã‚·ãƒ”æ•°: 0ä»¶

ğŸ”„ æ±Ÿæˆ¸æ–™ç†JSONãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...
  âœ… 42ä»¶ã®ãƒ¬ã‚·ãƒ”ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ
  âœ… 42ä»¶ã®æœ‰åŠ¹ãªãƒ¬ã‚·ãƒ”ã‚’æ¤œå‡ºã—ã¾ã—ãŸ

ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æŒ¿å…¥ä¸­...
  é€²æ—: 5ä»¶å®Œäº†
  é€²æ—: 10ä»¶å®Œäº†
  ...
  é€²æ—: 40ä»¶å®Œäº†

ğŸ‰ åŸºæœ¬ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸï¼
  ğŸ“Š ç™»éŒ²ã•ã‚ŒãŸãƒ¬ã‚·ãƒ”: 42ä»¶
  ğŸ“‹ ãƒ†ãƒ¼ãƒ–ãƒ«: edo_recipes, recipe_ingredients, recipe_instructions

ğŸ’¡ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:
  â€¢ ãƒ™ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–ã‚’å®Ÿè¡Œã—ã¦æ„å‘³æ¤œç´¢ã‚’æœ‰åŠ¹åŒ–
  â€¢ ã‚«ã‚¹ã‚¿ãƒ æ¤œç´¢ã‚„ã‚·ãƒŠãƒªã‚ªæ¤œç´¢ã‚’ãŠè©¦ã—ãã ã•ã„
```

#### æ³¨æ„äº‹é …
- æ—¢ã«ãƒ¬ã‚·ãƒ”ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
- JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã«å¤±æ•—ã—ãŸå ´åˆã¯å‡¦ç†ã‚’ä¸­æ–­

### 5. ãƒ™ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–

å…¨42ä»¶ã®æ±Ÿæˆ¸æ–™ç†ãƒ¬ã‚·ãƒ”ã®åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ã‚’ç”Ÿæˆã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚

#### æ©Ÿèƒ½æ¦‚è¦
- æ—¢å­˜ã®ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ã‚’ç¢ºèª
- ä¸è¶³åˆ†ã®åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ã‚’è‡ªå‹•ç”Ÿæˆ
- OpenAI APIä½¿ç”¨ã«ã‚ˆã‚‹é«˜å“è³ªãªåŸ‹ã‚è¾¼ã¿ä½œæˆ
- ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šã¨ç¢ºèªãƒ—ãƒ­ã‚»ã‚¹

#### å®Ÿè¡Œä¾‹
```
ğŸ”§ ãƒ™ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–

ğŸ“Š çŠ¶æ³ç¢ºèª:
  ç·ãƒ¬ã‚·ãƒ”æ•°: 42ä»¶
  æ—¢å­˜ãƒ™ã‚¯ã‚¿ãƒ¼æ•°: 5ä»¶

âš ï¸  37ä»¶ã®ãƒ¬ã‚·ãƒ”ã®ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚

ğŸ’° ç”Ÿæˆã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š:
  æ¨å®šãƒˆãƒ¼ã‚¯ãƒ³æ•°: 3,700
  æ¨å®šæ™‚é–“: 18.5ç§’
  æ¨å®šã‚³ã‚¹ãƒˆ: $0.000074 USD
             (ç´„0.011å††)

37ä»¶ã®ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ [y/N]: y

ğŸ”„ ãƒ™ã‚¯ã‚¿ãƒ¼ç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã™...
[ 1/37] ç³¸çµ„åµ                         âœ…
[ 2/37] äº”è‰²åµ                         âœ…
...

ğŸ‰ å…¨ãƒ¬ã‚·ãƒ”ã®ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼
```

#### æ³¨æ„äº‹é …
- OpenAI APIã‚­ãƒ¼ãŒå¿…è¦
- æ—¢ã«å…¨ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
- å‡¦ç†ä¸­æ–­æ™‚ã¯éƒ¨åˆ†çš„ãªçŠ¶æ…‹ã§ä¿å­˜ã•ã‚Œã‚‹

### 6. å…¨ãƒ‡ãƒ¼ã‚¿æ¶ˆå»

ãƒ‡ãƒ¢ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å®Œå…¨ã«å‰Šé™¤ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚

#### å‰Šé™¤å¯¾è±¡ãƒ†ãƒ¼ãƒ–ãƒ«
- `edo_recipes` (æ±Ÿæˆ¸æ–™ç†ãƒ¬ã‚·ãƒ”)
- `edo_recipe_vectors` (ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿)
- `recipe_similarities` (é¡ä¼¼åº¦ãƒ‡ãƒ¼ã‚¿)
- `vector_search_logs` (æ¤œç´¢ãƒ­ã‚°)
- `recipe_ingredients` (ãƒ¬ã‚·ãƒ”ææ–™)
- `recipe_instructions` (ãƒ¬ã‚·ãƒ”æ‰‹é †)

#### å®‰å…¨æ©Ÿèƒ½
- äºŒæ®µéšç¢ºèªãƒ—ãƒ­ã‚»ã‚¹
- 'DELETE' ã®æ–‡å­—åˆ—å…¥åŠ›ã«ã‚ˆã‚‹æœ€çµ‚ç¢ºèª
- å–ã‚Šæ¶ˆã—ä¸å¯ã®æ˜ç¢ºãªè­¦å‘Š

#### ä½¿ç”¨å ´é¢
- ãƒ‡ãƒ¢ç’°å¢ƒã®ãƒªã‚»ãƒƒãƒˆ
- æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã®ãƒ†ã‚¹ãƒˆ
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸é ˜åŸŸã®å®Œå…¨ã‚¯ãƒªã‚¢

#### æ¸¬å®šé …ç›®

- **å®Ÿè¡Œæ™‚é–“**: SQLã‚¯ã‚¨ãƒªå®Ÿè¡Œã‹ã‚‰Pythonçµæœå–å¾—ã¾ã§
- **CPUä½¿ç”¨ç‡**: æ¤œç´¢å‡¦ç†ä¸­ã®å¹³å‡CPUä½¿ç”¨ç‡
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: æ¤œç´¢å‡¦ç†ä¸­ã®ãƒ”ãƒ¼ã‚¯ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- **ãƒãƒƒãƒæ•°**: æ¤œç´¢çµæœä»¶æ•°

#### æ¯”è¼ƒè¡¨ç¤ºä¾‹

```
=== æ¤œç´¢æ‰‹æ³•æ€§èƒ½æ¯”è¼ƒ ===
ğŸ” æ®µéšçš„æ¤œç´¢ã‚’å®Ÿè¡Œä¸­...
å®Ÿè¡Œæ™‚é–“: 0.234ç§’ | CPUä½¿ç”¨ç‡: 45% | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 128MB | ãƒãƒƒãƒæ•°: 156ä»¶

ğŸ” ä¸¦åˆ—æ¤œç´¢ã‚’å®Ÿè¡Œä¸­...  
å®Ÿè¡Œæ™‚é–“: 0.187ç§’ | CPUä½¿ç”¨ç‡: 62% | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 156MB | ãƒãƒƒãƒæ•°: 203ä»¶

ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ã¿æ¤œç´¢ã‚’å®Ÿè¡Œä¸­...
å®Ÿè¡Œæ™‚é–“: 0.089ç§’ | CPUä½¿ç”¨ç‡: 23% | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 89MB | ãƒãƒƒãƒæ•°: 89ä»¶

ğŸ” æ„å‘³æ¤œç´¢ã®ã¿ã‚’å®Ÿè¡Œä¸­...
å®Ÿè¡Œæ™‚é–“: 0.334ç§’ | CPUä½¿ç”¨ç‡: 38% | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 201MB | ãƒãƒƒãƒæ•°: 234ä»¶

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æ¤œç´¢æ‰‹æ³•      â”‚å®Ÿè¡Œæ™‚é–“  â”‚CPUä½¿ç”¨ç‡â”‚ãƒ¡ãƒ¢ãƒª    â”‚æ¨å¥¨ç”¨é€” â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚æ®µéšçš„æ¤œç´¢    â”‚0.234ç§’  â”‚45%      â”‚128MB    â”‚ãƒãƒ©ãƒ³ã‚¹ â”‚
â”‚ä¸¦åˆ—æ¤œç´¢      â”‚0.187ç§’  â”‚62%      â”‚156MB    â”‚é«˜ç²¾åº¦   â”‚
â”‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ã¿â”‚0.089ç§’  â”‚23%      â”‚89MB     â”‚é«˜é€Ÿ     â”‚
â”‚æ„å‘³æ¤œç´¢ã®ã¿  â”‚0.334ç§’  â”‚38%      â”‚201MB    â”‚ç™ºè¦‹æ€§   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€æ¨å¥¨ã€‘ã“ã®æ¡ä»¶ã§ã¯ã€Œä¸¦åˆ—æ¤œç´¢ã€ãŒæœ€é©ã§ã™
ç†ç”±: é«˜ç²¾åº¦ã‚’ç¶­æŒã—ã¤ã¤é«˜é€Ÿãªå®Ÿè¡ŒãŒå¯èƒ½
```

## çµæœè¡¨ç¤ºã®è¦‹æ–¹

### åŸºæœ¬æƒ…å ±

```
=== æ¤œç´¢çµæœ ===
å®Ÿè¡Œæ™‚é–“: 0.234ç§’ | ç·ãƒãƒƒãƒæ•°: 156ä»¶ | è¡¨ç¤º: 10ä»¶
CPUä½¿ç”¨ç‡: 45% | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 128MB
```

### æ¤œç´¢å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
ã€æ¤œç´¢å‡¦ç†ã®æµã‚Œã€‘
Stage 1 (å…¨æ–‡æ¤œç´¢): 1,234ä»¶ â†’ 156ä»¶ (0.089ç§’)
Stage 2 (ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢): 156ä»¶ â†’ 156ä»¶ (0.134ç§’)
Stage 3 (ã‚¹ã‚³ã‚¢è¨ˆç®—): 156ä»¶ â†’ 10ä»¶ (0.011ç§’)
```

### å€‹åˆ¥çµæœè©³ç´°

```
ğŸ¥‡ ç¬¬1ä½ (ç·åˆã‚¹ã‚³ã‚¢: 0.89)
ã€ãƒ¬ã‚·ãƒ”åã€‘é¯›ã®ã ã—èŒ¶æ¼¬ã‘
ã€èª¬æ˜æ–‡ã€‘ä¸Šå“ãªé¯›ã®æ—¨ã¿ã¨ã ã—ã®é¦™ã‚ŠãŒèª¿å’Œã—ãŸã€ã‚ã£ã•ã‚Šã¨ã—ãŸä¸€å“
ã€ææ–™ã€‘é¯›, æ˜†å¸ƒã ã—, ç±³, æµ·è‹”, ã‚ã•ã³
ã€ãƒãƒƒãƒè©³ç´°ã€‘
  âœ… å¿…é ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: "ã ã—"(0.94), "é­šâ†’é¯›"(0.87)
  âŒ é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ãªã—
  ğŸ¯ æ„å‘³çš„é¡ä¼¼åº¦: 0.91 ("ã†ã¾å‘³ãŒã‚ã£ã•ã‚Š" ã¨ã®é¡ä¼¼æ€§)
  ğŸ“Š ã‚¹ã‚³ã‚¢å†…è¨³: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰(0.91) Ã— 0.3 + æ„å‘³çš„(0.91) Ã— 0.7 = 0.89
```

## å®Ÿç”¨çš„ãªä½¿ç”¨ä¾‹

### ä¾‹1: ç‰¹å®šã®é£Ÿæã‚’ä½¿ã£ãŸæ–™ç†æ¤œç´¢

```
ã€ã‚·ãƒ¼ãƒ³ã€‘åµã‚’ä½¿ã£ãŸæ–™ç†ã‚’æ¢ã—ãŸã„ãŒã€ç”˜ã„ã‚‚ã®ã¯é¿ã‘ãŸã„

è¨­å®š:
- å¿…é ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: åµ
- é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ç ‚ç³–, ç”˜ã„
- æ„å‘³çš„æ¤œç´¢: "æ–™ç†ã®ä¸»èœã‚„å‰¯èœ"
- æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰: æ®µéšçš„æ¤œç´¢
```

### ä¾‹2: å­£ç¯€ã«åˆã£ãŸæ–™ç†ã®ç™ºè¦‹

```
ã€ã‚·ãƒ¼ãƒ³ã€‘æ˜¥ã‚‰ã—ã„å½©ã‚Šè±Šã‹ãªæ–™ç†ã‚’ä½œã‚ŠãŸã„

è¨­å®š:
- å¿…é ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: æ˜¥, å½©ã‚Š
- æ„å‘³çš„æ¤œç´¢: "å­£ç¯€æ„Ÿã®ã‚ã‚‹ç¾ã—ã„æ–™ç†"
- é‡ã¿: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰(40%) + æ„å‘³çš„(60%)
- æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰: ä¸¦åˆ—æ¤œç´¢
```

### ä¾‹3: å¥åº·å¿—å‘ã®æ–™ç†æ¢ç´¢

```
ã€ã‚·ãƒ¼ãƒ³ã€‘ãƒ˜ãƒ«ã‚·ãƒ¼ã§æ „é¤Šãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„æ–™ç†ã‚’è¦‹ã¤ã‘ãŸã„

è¨­å®š:
- å¿…é ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: é‡èœ, å¥åº·
- é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: æ²¹, æšã’ã‚‹
- æ„å‘³çš„æ¤œç´¢: "æ „é¤Šä¾¡ãŒé«˜ãã¦ãƒ˜ãƒ«ã‚·ãƒ¼ãªé£Ÿäº‹"
- æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰: ä¸¦åˆ—æ¤œç´¢
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

**Q: æ¤œç´¢çµæœãŒ0ä»¶ã«ãªã£ã¦ã—ã¾ã†**
A: 
- é¡ä¼¼åº¦é–¾å€¤ã‚’ä¸‹ã’ã‚‹ï¼ˆ0.1ãªã©ï¼‰
- å¿…é ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¸›ã‚‰ã™
- é™¤å¤–æ¡ä»¶ã‚’ç·©å’Œã™ã‚‹

**Q: ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ãŒå‹•ä½œã—ãªã„**
A:
- ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- OpenAI APIè¨­å®šã‚’ç¢ºèª
- å…¨æ–‡æ¤œç´¢ã®ã¿ãƒ¢ãƒ¼ãƒ‰ã§ä»£æ›¿ä½¿ç”¨

**Q: æ€§èƒ½ãŒé…ã„**
A:
- æ®µéšçš„æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
- çµæœä»¶æ•°ã‚’åˆ¶é™ï¼ˆmax_resultsï¼‰
- å¿…é ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§äº‹å‰çµã‚Šè¾¼ã¿

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ç¢ºèª

```bash
# ãƒ†ãƒ¼ãƒ–ãƒ«å­˜åœ¨ç¢ºèª
docker exec python_postgres_demo python -c "
import sys; sys.path.append('/app/src')
from common.database_config import DatabaseConfig
import psycopg2

db_config = DatabaseConfig.from_environment()
conn = psycopg2.connect(**db_config.to_connection_params())
cur = conn.cursor()

# Check tables
tables = ['edo_recipes', 'edo_recipe_vectors']
for table in tables:
    cur.execute(f\"SELECT COUNT(*) FROM information_schema.tables WHERE table_name = '{table}'\")
    exists = cur.fetchone()[0] > 0
    if exists:
        cur.execute(f'SELECT COUNT(*) FROM {table}')
        count = cur.fetchone()[0]
        print(f'{table}: âœ… ({count}ä»¶)')
    else:
        print(f'{table}: âŒ')

conn.close()
"
```

## æŠ€è¡“ä»•æ§˜

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
Demo Application (UI)
       â†“
Search Service (Business Logic)
       â†“
Hybrid Manager (Database Operations)
       â†“
PostgreSQL (pg_bigm + pg_vector)
```

### ä½¿ç”¨æŠ€è¡“

- **PostgreSQL 16**: ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **pg_bigm 1.2**: æ—¥æœ¬èªå…¨æ–‡æ¤œç´¢æ‹¡å¼µï¼ˆGIN Indexï¼‰
- **pg_vector 0.7.4**: ãƒ™ã‚¯ã‚¿ãƒ¼æ¤œç´¢æ‹¡å¼µï¼ˆHNSW Indexï¼‰
- **OpenAI API**: text-embedding-3-smallåŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«
- **Python 3.11**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºè¨€èª
- **psycopg2**: PostgreSQLãƒ‰ãƒ©ã‚¤ãƒãƒ¼
- **psutil**: ã‚·ã‚¹ãƒ†ãƒ æ€§èƒ½æ¸¬å®š

### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ§‹é€ 

```sql
-- pg_bigmç”¨GINã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆGeneralized Inverted Indexï¼‰
CREATE INDEX idx_edo_recipes_bigm_name ON edo_recipes 
    USING gin (name gin_bigm_ops);

-- pg_vectorç”¨HNSWã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆHierarchical Navigable Small Worldï¼‰
CREATE INDEX idx_edo_recipes_embedding ON edo_recipe_vectors 
    USING hnsw (combined_embedding vector_cosine_ops);
```

## å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

ã“ã®ãƒ‡ãƒ¢ã‚’é€šã˜ã¦ä»¥ä¸‹ã‚’å­¦ç¿’ã§ãã¾ã™ï¼š

1. **pg_bigmã¨pg_vectorã®å®Ÿç”¨çš„ãªçµ„ã¿åˆã‚ã›æ–¹æ³•**
2. **è¤‡åˆæ¤œç´¢æ¡ä»¶ã®åŠ¹ç‡çš„ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**
3. **æ¤œç´¢ç²¾åº¦ã¨å®Ÿè¡Œé€Ÿåº¦ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ç†è§£**
4. **é€æ˜æ€§ã®é«˜ã„ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…**
5. **å®Ÿä¸–ç•Œã®ãƒ‹ãƒ¼ã‚ºã«å¯¾å¿œã—ãŸæ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ**

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸](./edo_recipe_hybrid_search_design.md)
- [æ±Ÿæˆ¸æ–™ç†æ¤œç´¢ãƒ‡ãƒ¢ã‚¬ã‚¤ãƒ‰](./edo_recipe_demo.md) - pg_bigmå…¨æ–‡æ¤œç´¢
- [æ±Ÿæˆ¸æ–™ç†ãƒ™ã‚¯ã‚¿ãƒ¼æ¤œç´¢ãƒ‡ãƒ¢ã‚¬ã‚¤ãƒ‰](./edo_recipe_vector_demo.md) - pg_vectoræ„å‘³æ¤œç´¢